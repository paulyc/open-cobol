\documentclass[a4paper,oneside,svgnames]{scrbook}

\usepackage{microtype}
\usepackage[toc,page]{appendix}
\usepackage{booktabs}
\usepackage{textcomp}

% for arithmetic expression table
\usepackage{pifont}
\newcommand{\tick}{\ding{51}}
\usepackage{multirow}

% Erewhon is for math mode.
\usepackage[proportional,scaled=1.064]{erewhon}
\usepackage[erewhon,vvarbb,bigdelims]{newtxmath}
\usepackage{roboto}
\usepackage[T1]{fontenc}
\renewcommand*\oldstylenums[1]{\textosf{#1}}

\usepackage[dvipsnames]{xcolor}
\usepackage{afterpage}
\usepackage{tikz}
\usepackage[printwatermark]{xwatermark}
\usepackage[tocindentauto]{tocstyle}
\usetocstyle{standard}
\usepackage[most]{tcolorbox} % for coloured boxes and warning boxes
\usepackage[pdfauthor={Edward Hart},
            pdftitle={The GnuCOBOL 2.0 Grammar},
            pdfkeywords={GnuCOBOL,COBOL,manual,grammar,guide},
            colorlinks]{hyperref}

\newcommand{\clearpageifnotfirst}[1]{%
  \ifnum\value{#1}>0 \clearpage{} \fi%
}

\newtcolorbox{streak}[1][]{frame code={}
  halign title=flush center,
  left=40mm,
  right=40mm,
  top=10pt,
  bottom=10pt,
  colback=Maroon,
  colupper=white,
  left skip=40mm,
  grow to left by=40mm,
  right skip=40mm,
  grow to right by=40mm,
  width=\paperwidth,
  text width=\textwidth,
  arc=0pt,outer arc=0pt,
  #1
}

% \newtcolorbox{syntaxbox}[1][]{enhanced,
%   before skip=2mm,after skip=3mm,
%   boxrule=0.4pt,left=5mm,right=2mm,top=1mm,bottom=1mm,
%   colback=yellow!50,
%   colframe=yellow!20!black,
%   sharp corners,rounded corners=southeast,arc is angular,arc=3mm,
%   underlay={%
%     \path[fill=tcbcol@back!80!black] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
%     \path[draw=tcbcol@frame,shorten <=-0.05mm,shorten >=-0.05mm] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
%     \path[fill=yellow!50!black,draw=none] (interior.south west) rectangle node[white]{\Huge\bfseries !} ([xshift=4mm]interior.north west);
%     },
%   drop fuzzy shadow}

\newtcolorbox{syntaxbox}[1][]{enhanced,
  boxrule=0.4pt,left=1mm,right=1mm,top=1mm,bottom=1mm,
  sharp corners,% Rectangular shape
  halign=flush left,% To prevent spread out lines
  parbox=false,% To give normal paragraph indentation.
  before upper={\parskip3pt\parindent15pt}%
}

\renewcommand{\arraystretch}{1.2}
\def\defaultparskip{\parskip}

\newenvironment{syntax}{%
  \begin{syntaxbox}\small\selectfont\setlength{\parskip}{\baselineskip}}{%
  \setlength{\parskip}{\defaultparskip}\normalsize\selectfont\end{syntaxbox}}

\renewcommand{\familydefault}{\sfdefault}

\newcommand{\metaelement}[1]{%
  \textit{#1}%
}

\newcommand{\newlexicalelement}[1]{%
  \newcounter{#1}[subsection]%
  \expandafter\newcommand\csname #1\endcsname{%
    \stepcounter{#1}%
    \metaelement{#1-\arabic{#1}}\ {}%
  }%
}

\newcommand{\newlexicalelementwithname}[2]{%
  \newcounter{#1}[subsection]%
  \expandafter\newcommand\csname #1\endcsname{%
    \stepcounter{#1}%
    \metaelement{#2-\arabic{#1}}\ {}%
  }%
}

\newcounter{format}[subsection]
\newcommand{\format}[1]{%
  \stepcounter{format}%
  \paragraph{Format \arabic{format}\vspace{1em}\ {}(#1)}\ {}\newline%
}

\newcommand{\key}[1]{\underline{#1}}
\newcommand{\directiveindicator}[0]{>{}>}
\newcommand{\deleted}[1]{%
  \colorbox{red!75}{#1}}
\newcommand{\archaic}[1]{%
  \colorbox{pink}{#1}}
\newcommand{\obsolete}[1]{%
  \colorbox{red!60}{#1}}
\newcommand{\xopen}[1]{%
  \colorbox{green!75}{#1}}
\newcommand{\gnucobol}[1]{%
  \colorbox{orange!75}{#1}}
\newcommand{\miscext}[1]{%
  \colorbox{blue!50}{#1}}
\newcommand{\pending}[1]{%
  \textcolor{gray!75}{#1}}
\newcommand{\standard}[1]{%
  \colorbox{white}{#1}}

\newenvironment{0-1}{$\left[ \begin{tabular}{@{}l@{}}}{\end{tabular} \right]$}
\newenvironment{0+}{$\left[\left| \begin{tabular}{@{}l@{}}}{\end{tabular} \right|\right]$}
\newenvironment{1=}{$\left\{ \begin{tabular}{@{}l@{}}}{\end{tabular} \right\}$}
\newenvironment{1+}{$\left\{\left| \begin{tabular}{@{}l@{}}}{\end{tabular} \right|\right\}$}

\begin{document}

\newsavebox\mybox
\savebox\mybox{\tikz[color=gray,opacity=0.3]\node{DRAFT};}
% \newwatermark*[
%   allpages,
%   angle=45,
%   scale=12,
%   xpos=-42,
%   ypos=39
% ]{\usebox\mybox}

\newlexicalelementwithname{arithmeticexpression}{arithmetic-expression}
\newlexicalelementwithname{conditionname}{condition-name}
\newlexicalelementwithname{filename}{file-name}
\newlexicalelementwithname{functionname}{function-name}
\newlexicalelementwithname{imperativestatement}{imperative-statement}
\newlexicalelementwithname{cobolindexname}{index-name}
\newlexicalelementwithname{libraryname}{library-name}
\newlexicalelementwithname{mnemonicname}{mnemonic-name}
\newlexicalelementwithname{procedurename}{procedure-name}
\newlexicalelementwithname{pseudotext}{pseudo-text}
\newlexicalelementwithname{recordname}{record-name}
\newlexicalelementwithname{reportname}{report-name}
\newlexicalelementwithname{sourcetext}{source-text}
\newlexicalelementwithname{textname}{text-name}
\newlexicalelement{argument}
\newlexicalelement{condition}
\newlexicalelement{expression}
\newlexicalelement{identifier}
\newlexicalelement{integer}
\newlexicalelement{literal}
\newlexicalelementwithname{switchstatusname}{switch-status-name}
\newlexicalelementwithname{switchname}{switch-name}
\newlexicalelementwithname{systemname}{system-name}
\newlexicalelementwithname{computername}{computer-name}

\frontmatter

\begin{titlepage}
  \pagecolor{Maroon!75}\afterpage{\nopagecolor}

  \centering

  \vfill

  \begin{streak}[bottom=7.5pt]
    {\centering\fontsize{32pt}{0cm}\bfseries
      The GnuCOBOL 2.0 Grammar \par
    }
    \vspace{1em}
    {\centering\scshape\LARGE for r1141 \par}
  \end{streak}

  \vspace{3cm}
  \begin{streak}
    {\LARGE\itshape Edward Hart\par}
    \vspace{5pt}
    {\large\href{mailto:edward.dan.hart@gmail.com}{\color{white}{edward.dan.hart@gmail.com}}}
  \end{streak}

  \vfill

  % Bottom of the page
  \begin{streak}[top=3pt,bottom=3pt]
    {\Large \today\par}
  \end{streak}
\end{titlepage}

\topskip0pt
\vspace*{\fill}

COBOL is an industry language and is not the property of any company or group of companies, or of any organisation or group of organisations.

No warranty, expressed or implied, is made by any contributor, or by the CODASYL COBOL Committee,\footnote{The CODASYL COBOL committee was dissolved in 1992. Its work was continued by ANSI X3J4 and then INCITS PL22.4, which was itself dissolved in 2015.} as to the accuracy and functioning of the programming system and language. Moreover, no responsibility is assumed by any contributor, or by the committee, in connection therewith.

The authors and copyright holders of the copyrighted materials used herein are:
\begin{itemize}
\item FLOW-MATIC (trademark of Sperry Rand Corporation), Programming for the UNIVAC \textregistered{} I and II, Data Automation Systems, copyrighted 1958, 1959 by Sperry Rand Corporation,\footnote{Sperry Rand's computer business is now part of Unisys.}
\item IBM Commercial Translator, Form No. F28-8013, copyrighted 1959 by IBM, and
\item FACT, DSI 27A5260-2760, copyrighted 1960 by Minneapolis-Honeywell.
\end{itemize}

They have specially authorised the use of this material, in whole or in part, in the COBOL specifications. Such authorisation extends to the reproduction and use of COBOL specifications in programming manuals or similar publications.

\vfill

\begin{center}
  This work is typeset in Roboto.
\end{center}

\vfill

\begin{center}
  Copyright \textcopyright{} \the\year{} Edward Hart

  \vspace{5pt}

  Permission is granted to copy, distribute and\slash{}or modify this document under the terms of the GNU Free Documentation License, Version 1.3 or any later version published by the Free Software Foundation; with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts. Your attention is drawn to the copy of the license in Appendix \ref{label_fdl}.
  \vspace{5pt}

  The moral rights of the author have been asserted.
\end{center}

\tableofcontents

\input{foreword}
\input{changelog}

\mainmatter

\input{key}

\preto\section{\clearpageifnotfirst{section}}

\input{language-fundamentals}

\preto\subsection{\clearpageifnotfirst{subsection}}

\input{directives}
\input{compilation-group}
\input{identification}
\input{environment}
\input{data}
\input{procedure}
\input{intrinsics}

\begin{appendices}
  \input{gfdl}
\end{appendices}

\end{document}
